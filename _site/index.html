<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BeyondThunderdo.me</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <link rel="shortcut icon" href="images/favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
    <div id="header">
        <nav>
            <li class="fork"><a href="/">BeyondThunderdo.me</a></li>
            <li class="fork"><a href="/projects/">Projects</a></li>
            <li class="fork"><a href="/music/">Music</a></li>
            <li class="fork"><a href="/archive/">Archive</a></li>
        </nav>
    </div><!-- end header -->



    <div class="wrapper">

                <section>

    <div id="title">
        <h1>BeyondThunderdo.me</h1>
        <p>Code, Music, and Mad Max</p>
    </div>

    <div style="display:table, width: 50%">
    <hr>

        <div class="personalDescription">
            <img src="/images/RobertOnBeach.png" title="Thanks, Emma Ross :)">
            <h3>Robert Butler</h3>
            Software Engineer<br> 
            <a href="http://www.orpheusinteractive.com">Orpheus Interactive</a><br>
            <a href="https://twitter.com/BoTreats"><img src="/images/twitterIcon.png" class="iconLinkImage"></a>
            <a href="https://github.com/rbrt"><img src="/images/githubIcon.png" class="iconLinkImage"></a>
            <a href="https://ca.linkedin.com/pub/robert-butler/ab/ab9/753"><img src="/images/linkedinIcon.png" class="iconLinkImage"></a>
            <a href="mailto:robbutler902@gmail.com"><img src="/images/mailIcon.png" class="iconLinkImage"></a>
        </div>
    </div>


    
        <div class="post">
            <h2 id="james-quaternion">James Quaternion</h2>
<h5>February 25 2015</h5>

<p>For the last week and a half I’ve been working on something tentatively titled <i>James Quaternion</i>.</p>

<p><img src="/images/JamesQuaternionFlightDemo.gif" /></p>

<p>I’m trying to create an aesthetic influenced by Star Fox 64, and the game is
sort of evolving as I implement different effects and mechanics. It’s been fun,
and my first real foray into doing anything in 3D beyond really short game jams.
To get a pixelated effect, I’m pushing the camera to a 256x256 RenderTexture
which is placed in front of an orthographic camera. This gives me a really blocky
screen for free, and should also be nice for adding other fullscreen effects
down the line.</p>

<p>I decided to spend more time in Blender, and have been making almost all of the
assets for the game using it. The water and land are procedurally generated, but
the ships, lasers, explosions, etc. have all been made in Blender. Right now I’m
using a bunch of materials to colour the individual parts of each model, but I want
to provide vertex colour data to the models and get at that in the shader to save
from having so many materials in a scene.</p>

<h5><i>The player's fighter</i></h5>
<p><img src="/images/JamesQuaternionFighter.png" /></p>

<h5><i>An enemy blomp</i></h5>
<p><img src="/images/JamesQuaternionBlomp.png" /></p>

<p>So far, aside from flying around, you can shoot lasers (both charge shots and
regular shots) and launch seeker missiles. I implemented the laser charge by using
a particle system with a negative velocity so that it emits inwards. A parameter
controls the colour of the charge shot, and will also be tied to damage when damage
is programmed. The missiles are kind of cheating as they just have force applied
and use Transform.LookAt to move towards their target, but the effect works well
enough.</p>

<h5><i>Charge shots and seeker missiles</i></h5>
<p><img src="/images/JamesQuaternionLaserMissileDemo.gif" /></p>

<p>I implemented a shield by wrapping the fighter in a low poly sphere and modified
Unity’s transparent shader to produce three ripples based on two offset values.
Whenever the shield gets hit, the shield gets rotated to face the point of impact,
and then a coroutine quickly lerps the two values to produce a shield ripple effect.
I don’t cull the front or back faces, so that you can see the shield ripples all the time.
I also implemented a boost which is pretty straightforward, but I made the boost fire in
Blender and have the engine trails changing colour. I was trying to find a way to
modify Unity’s TrailRenderer Colour array, but it doesn’t seem to be possible without
editor scripting. (The only way I could get this to work was with the PGJ’s <a href="http://forum.unity3d.com/threads/trail-renderer-colors-c.54162/">post</a>)
This is a bummer because the gradual altering of each element of the array looked a
lot better than affecting the material all at once. Ah well.</p>

<h5><i>Shield and boost</i></h5>
<p><img src="/images/JamesQuaternionShieldDemo.gif" /></p>

<p>Over the weekend, I implemented water as well which was a lot of fun. I decided
to do it using Gerstner waves from this
<a href="http://graphics.ucsd.edu/courses/rendering/2005/jdewall/tessendorf.pdf">paper’s</a>
section on “Practical Ocean Wave Algorithms”. The equation for generating waves involves
summing a series of waves with a few parameters that allow you affect frequency, amplitude,
direction, and (cool but not used in my case) curl of the wave. A single wave looks
like this:</p>

<h5><i>Gerstner Wave</i></h5>
<p><img src="/images/GerstnerWave.png" /></p>

<p>And it generalizes to this:</p>

<h5><i>Summation of Gerstner Waves</i></h5>
<p><img src="/images/GerstnerGeneralized.png" /></p>

<p>I implemented that in a vertex shader which gets applied to a flat shaded procedurally
generated plane, which looks like this:</p>

<h5><i>Oooo, water...</i></h5>
<p><img src="/images/JamesQuaternionWaterDemo.gif" /></p>

<p>Which admittedly is probably pretty simple and could be accomplished with a much less
involved shader, but whatever, this was fun to write. I really want to be recomputing
face normals on the fly so that the colours change, but I don’t know of any way to do this
without using geometry shaders, which I can’t do in Unity on OSX with an integrated
graphics chip. My assumption here is that I would be able to get information about the
current triangle in the geometry shader, as opposed to trying to figure that out in
a vertex shader which has no knowledge of the other vertices. I might write this on
a windows box or my iMac at work just to see how it looks. Also, if you crank up the
poly count and parameter values, then you get some big rolling waves:</p>

<h5><i>Big old waves</i></h5>
<p><img src="/images/JamesQuaternionBigWaves.gif" /></p>

<p>I’ve also been working on an effect to distort the area underneath the player. It
works by passing information about the player’s position into the vertex shader, when
the player is flying lower than a certain height. A triangle is projected onto the mesh,
which grows as the player gets closer. Inside this triangle, the waves are distorted
at a different rate than the rest of the waves, sort of making it look like the
engines are pushing the waves aside. I haven’t quite nailed this effect down yet
and it’s especially jarring at the back of the trail, but at present it looks like this:</p>

<h5><i>Wave distortion in relation to the player</i></h5>
<p><img src="/images/JamesQuaternionWaveDisplacement.gif" /></p>

<p>Anyway, more to come…. at some point!</p>

        </div>

    	<hr>
    
        <div class="post">
            <h2 id="fun-with-tool-development">Fun With Tool Development</h2>
<h5>December 31 2014</h5>

<p>I really like making tools. The most experience I have with this is in the context
of editor scripting in Unity, but it’s something I’ve been doing whenever it makes
sense. I’ve found that I really enjoy tool development because it’s wonderful to
click a button or run a command and have a tedious process completed quickly and
automatically. But since developing tools for production, I’ve also found another
aspect which I really enjoy: the quick feedback loop.</p>

<p>In my situation, the tools are put into use almost instantly, because they’re
usually developed to solve a problem currently facing the team. Sometimes, the
tools are put into use before they’re even really completed. This leads to a
process where I’m getting feedback on what is and isn’t useful, and what would be
better right away. To contrast this with the other development I do at work, aside
from limited playtesting, we have had no outside eyes on our game, and thus no
feedback. I find it immensely satisfying to know that people are using things I’ve
created, and with tool development, that occurs quickly and often.</p>

<p>Here are some tools I’ve made over the last year that have been fun to implement:</p>

<h4>Automatic Navmesh Generation</h4>

<p>We have a large, streaming world comprised of many scenes. (I want to take a moment to plug
<a href="http://www.sectr.co/">SECTR</a> which has helped out a lot!) Unity has a limitation
(which looks to be addressed in the upcoming Unity 5) that prevents us from streaming
in navmeshes, so the solution is to have one large navmesh. Importing all the relevant
geometry is time consuming, annoying, and frequently causes the poor 32-bit application
to crash. To solve this, I wrote a tool which gradually imports each scene and deletes
everything which will not be included in the navmesh (see: not marked navmesh static).
At every stage of the process, the temporary scene is saved and the import progress is
stored in a scriptable object. This allows us to resume from where we left off in the
event of a crash. Once all of the scene contents have been imported,then the
giant navmesh is baked.</p>

<h5><i>Selecting what to include in Navmesh</i></h5>
<p><img src="/images/AutomateNavmeshMenu.png" /></p>

<h5><i>End result</i></h5>
<p><img src="/images/BakedNavmesh.png" /></p>

<p>Before having this tool, one of our devs would have to be tied up for the duration of
each import, as well as the final bake. Each manual import of each scene was
essentially a roll of the dice, as it was very likely that Unity would crash (and
more so with each successive scene) especially considering that all GameObjects were
kept around. Deleting all of the non-essential objects helped out considerably.</p>

<p>The only parts of this process that are not automatic are clicking the buttons to
invoke the import and bake, and then reverting all changes (except the new navmesh)
in mercurial. Reverting changes in source control is somewhat heavy handed, but it’s
quick, foolproof, and allows us to do the very destructive operation of deleting
all non-essential objects safely.</p>

<h4>Automatic Creation and Updating of Mecanim Animation State Machines</h4>

<p>We have a great deal of assets whose names are just hashes, and these need to be
associated with animations. We had hoped that we could do something at runtime
using override controllers, but found that in order to play things smoothly, on
demand, and without crashing, we needed to have the relevant animations already
set up in a state machine. To this end, I created a tool to build these large
state machines, which look like this:</p>

<h5><i>I tweeted this on the day of writing the tool</i></h5>
<p><img src="/images/AnimationStateMachineTweet.png" /></p>

<p>They are gross to look at (and actually, the states are all on top of eachother.
I spread those out manually for the screenshot) but are basically never used by
a developer directly; all invokation is done by hash reference through code. I
had so much fun with this because I got to use reflection (&lt;3) to get at all of
the underlying functions to construct the state machines. Apparently there is a
much more expansive API for Mecanim in Unity 5 which I haven’t looked into yet,
so reflection might not be necessary going forward.</p>

<p>First, I had to poke around for a bit to see how things work and what was available,
and then I started on generating state machines. Since we don’t need transitions
defined (we just crossfade into animations) this was pretty straightforward, but
fun nonetheless. The tool is able to generate a new layer (so as not to interfere
with the other states on an AnimationController) and also able to update an existing
layer when new animations are added. It took something that would’ve been really
tedious and error prone, and made it into a development step that runs in a few
seconds.</p>

<h4>Automatic Creation of Enemy Encounters</h4>

<p>In my spare time I’ve been working on a 2D beat ‘em up which I’ve written about
before, still tentatively titled PK. Recently, I’ve made the notion of an enemy
encounter. This is an event which is triggered by the player advancing to a certain
point in the world, which results in spawning different types and amounts of enemies,
changing the music, playing a visual cue, etc. The encounters themselves are
implemented as a small hierarchy of GameObjects, with some internal references as
well as references to controllers and instance objects in the scene. While it is
fairly straightforward to set up by hand, I decided to automate the process.</p>

<p>I wrote a small editor script which creates and names the required empty GameObjects,
attaches the required components, and assigns the default references. In this manner
I can set up a new fight relatively quickly and not get bogged down making sure I’ve
done the grunt work properly each time. This took very little time to do, around
30 minutes, and has saved me a fair bit of time already.</p>

<h5><i>Automation</i></h5>
<p><img src="/images/EnemyEncounterCreator1.png" />
<img src="/images/EnemyEncounterCreator2.png" />
<img src="/images/EnemyEncounterCreator3.png" /></p>

<h4>Lists to Dictionary Inspector</h4>

<p>Another deficiency of Unity is that you can’t serialize a dictionary. Because key-value
pairs are wonderful for all sorts of things, this gets annoying. Aside from losing
the ability to easily store key-value pairs, Unity also provides no facilities for
managing a dictionary in the inspector. A quick workaround for the serialization
problem is to use two lists or arrays to hold the keys and values, and then
convert them to and from a dictionary at runtime. I wrote a small custom class that
can be inherited from to make a quick, self-managing pair of lists with dictionary
conversion methods. This still doesn’t provide the key-value representation in the
inspector though, so I wrote a custom inspector to display the list contents as
key value pairs. In this manner, I can now create and manage dictionaries in a fashion
similar to other collections.</p>

        </div>

    	<hr>
    
        <div class="post">
            <h2 id="orpheus-game-jam">Orpheus Game Jam</h2>
<h5>December 15 2014</h5>

<p>Today at the office we had an in house game jam for a day. The team produced
about 10 games in total, many of which were Christmas themed. It was a blast to
take the day and just make something on the office machines. It was also really
cool to see what everyone had come up with at the end of the day. I worked alone
and decided to continue getting mileage out of the rigged baby model I bought
for Catastrophe Jam. The result was Rabies Babies (jam theme was “two words
that rhyme”):</p>

<p><img src="/images/RabiesBabies.gif" /></p>

<p>I need to stop making things with Unity 5 so that I can actually post playable
builds…</p>

        </div>

    	<hr>
    
        <div class="post">
            <h2 id="catastrophe-jam">Catastrophe Jam</h2>
<h5>December 12 2014</h5>

<p>The first (and only?) annual Catastrophe Jam is finishing up at Volta tonight.
The rough premise is that you have three hours to make a game, but beyond that,
there aren’t really any rules. There would up being about 30 or 40 people taking
part, which was awesome. We saw a bunch of different submissions which varied
substantially in how far complete they were.</p>

<p>I made Babby’s Quest. A third-person action adventure game. Here are two gifs
from it:</p>

<p><img src="/images/BabbysQuest1.gif" /></p>

<p><img src="/images/BabbysQuest2.gif" /></p>

<p>It was a ridiculous night.</p>

        </div>

    	<hr>
    
        <div class="post">
            <h2 id="getting-artsy">Getting Artsy</h2>
<h5>December 10 2014</h5>

<p>I’ve been messing around with Blender lately and it’s been hilarious. I decided
that neglecting to have any 3D ability is probably a bad idea, and that it can’t
be that hard to learn. Where I like the idea of things looking really goofy, it
seems that making basic, silly 3D monstrosities should be a fun exercise. So,
without much concern so far for things like UV mapping or worrying about poly
count, I set out to make some stuff.</p>

<p>The first one is… Chuds Bandbox. I can’t
really explain this much more than writing out the title. Who or what is chud?
What is a bandbox? Why did I make this? I don’t know, but me and @mrdanielbrauer
are 100% responsible for it:</p>

<p><img src="/images/ChudsBandbox.gif" /></p>

<p>The next thing I made was a dude made out of stretched and extruded primitives
for the Halifax Game Collective’s Cool Kidz jam. I didn’t really complete a game,
but I did make this dude. I made the sunglasses from scratch; definitely a proud
moment…? The only document I have of this on hand is a saved snapchat converted
to a gif, so here it is:</p>

<p><img src="/images/CoolKidzSnapchat.gif" /></p>

<p>I want to play around more with Blender and learn about some intermediate concepts,
as well as maybe make things that aren’t just slightly altered primitive shapes,
but it has still been a blast to mess around with.</p>

        </div>

    	<hr>
    

    <a href="/archive/"><h1 style="text-align:center; margin-top:5%;">Older Posts</h1></a>



</section>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-53820142-1', 'auto');
        ga('send', 'pageview');
    </script>
  </body>
</html>
